<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>単純なIncremental</title>
    <script src="https://unpkg.com/break_infinity.js@2.0.0/dist/break_infinity.min.js"></script>
</head>
<body>
<h1>単純なIncremental</h1>

<div class="tabs">
    <button onclick="showTab('main-tab')">メイン</button>
    <button onclick="showTab('Milestone-tab')">マイルストーン</button>
    <button id="upgrade-tab-btn" onclick="showTab('Upgrade-tab')" style="display: none;">アップグレード</button>
    <button id="meta-tab-btn" onclick="showTab('Meta-tab')" style="display: none;">メタ</button>
</div>

<hr>

<div id="main-tab">
    <p>人口: <span id="people-count">0</span> 人</p>
    <p>秒間の自動生産量: <span id="per-second-display">0</span></p>
    <button onclick="clickHandler()">人口を増やす</button>
    <div id="meta-exponent" style="display: none; margin-top: 10px; border: 1px solid #888; padding: 5px;">
    <p>Meta-Pointsによる累乗:^<span id="meta-power">1</span></p>
    </div>
    <div id="autobuyer-controls" style="display: none; margin-top: 10px; border: 1px solid #888; padding: 5px;">
    <h4>自動購入システムVer1</h4>
    <p>状態: <span id="autobuyer-status">ON</span></p>
    <button onclick="toggleAutoBuyer()">ON/OFF 切り替え</button>
</div>

<div id="autobuyer2-controls" style="display: none; margin-top: 10px; border: 1px solid #888; padding: 5px;">
    <h4>自動購入システムVer2</h4>
    <p>状態: <span id="autobuyer2-status">ON</span></p>
    <button onclick="toggleAutoBuyer2()">ON/OFF 切り替え</button>
</div>

<div id="autobuyer3-controls" style="display: none; margin-top: 10px; border: 1px solid #888; padding: 5px;">
    <h4>自動購入システムVer3</h4>
    <p>状態: <span id="autobuyer3-status">ON</span></p>
    <button onclick="toggleAutoBuyer3()">ON/OFF 切り替え</button>
</div>

<div id="autobuyer4-controls" style="display: none; margin-top: 10px; border: 1px solid #888; padding: 5px;">
    <h4>自動購入システムVer4</h4>
    <p>状態: <span id="autobuyer4-status">ON</span></p>
    <button onclick="toggleAutoBuyer4()">ON/OFF 切り替え</button>
</div>


    <h3>生贄の儀式</h3>
    <p>1クリックあたりの増加量: <span id="power-display">1</span></p>
    <p><span id="sacrificeCost-display">10</span>人を捧げて、効率UP!</p>
    <button onclick="sacrifice()">生贄を捧げる</button>

    <h3>農家 (Farmer)</h3>
    <p>コスト: <span id="farmerCost-display">500</span>人</p>
    <button onclick="buyFarmer()">農家を雇う</button>
    
    <div id="grandma-unlock-area" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
    <h3>グランマ (Grandma)</h3>
    <p>農家の効率を<span id="boostedMultiplier-display">2</span>倍にする聖なる存在</p>
    <p>コスト: <span id="grandmaCost-display">1e15</span>人</p>
    <p>現在の数: <span id="grandma-count">0</span>人</p>
    <button onclick="buyGrandma()">グランマに祈る</button>
    </div>
    
    <div id="shrine-area" style="display:none; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <h3>聖域 (Sanctuary)</h3>
    <p>グランマのベースを強化する施設</p>
    <p>コスト: <span id="shrineCost-display">1e50000</span></p>
    <p>現在の数: <span id="shrine-count">0</span></p>
    <button onclick="buyShrine()">建設する</button>
    </div>

    <div id="quantum-area" style="display:none; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <h3>量子圧縮 (Quantum Compression)</h3>
    <p>人間を量子圧縮する。自動生産量に^<span id="quantum-effect">1</span></p>
    <p>コスト: <span id="quantumCost-display">e100億</span></p>
    <p>現在の数: <span id="quantum-count">0</span></p>
    <button onclick="buyQuantum()">建設する</button>
    </div>
    
    <div id="atom-area" style="display:none; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <h3>原子回帰 (Atomic Regression)</h3>
    <p>人が収まらないのなら、人を小さくすればいいじゃない<br>量子圧縮パワーを<span id="atom-effect">1</span>倍する</p>
    <p>コスト: <span id="atomCost-display">e1兆</span></p>
    <p>現在の数: <span id="atom-count">0</span></p>
    <button onclick="buyAtom()">人を小さくする</button>
    </div>
    
    <div id="program-area" style="display:none; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <h3>プログラム (Program)</h3>
    <p>人を0ビットの情報に書き換える<br>原子回帰の効果量を<span id="program-effect">1</span>倍する</p>
    <p>コスト: <span id="programCost-display">e100京</span></p>
    <p>現在の数: <span id="program-count">0</span></p>
    <button onclick="buyProgram()">書き換える</button>
    </div>

</div>
</div>

<div id="Milestone-tab" style="display: none;">
    <h3>マイルストーン</h3>
    <p id="ms3000">人口3000人到達：農家効率2倍 ❌</p>
    <p id="ms10000">人口10000人到達：クリック^5 ❌</p>
    <p id="ms8E9">人口80億人到達：クリック^2 ❌</p>
    <p id="ms8E16">人口8京人到達：農家効率^2 ❌️</p>
    <p id="ms1E400">人口e400人到達：グランマベース×2 ❌️</p>
     <p id="ms1E10000">人口e1万人到達：グランマベース×4 ❌️</p>
     <p id="ms1E50000">人口e5万人到達：新しい施設のアンロック ❌️</p>
     <p id="ms1E350000">人口e35万人到達：グランマベース^2&グランマ自動購入効率×5 ❌️</p>
     <p id="ms1E1_2E6">人口e100万人到達：聖域指数に+1 ❌️</p>
     <p id="ms1E2E6">人口e200万人到達：聖域指数に+1&アップグレードタブアンロック ❌️</p>
     <p id="ms1E3E7">人口e3000万人到達：新しいアップグレードのアンロック ❌️</p>
     <p id="ms1E5E8">人口e5億人到達：新しいアップグレードのアンロック ❌️</p>
     <p id="ms1E1E10">人口e100億人到達：新しい施設のアンロック ❌️</p>
     <p id="ms1E2E10">人口e200億人到達：全アップグレード&全施設強化！ ❌️</p>
     <p id="ms1E7E12">人口e7兆人到達：ダブル！全アップグレード&全施設強化！ ❌️</p>
     <p id="ms1E5E14">人口e500兆人到達：ダブル！新しい施設と新しいアップグレード ❌️</p>
     <p id="ms1E5E18">人口e500京人到達：アップグレード1〜4&施設:聖域、量子圧縮、原子回帰の自動購入 ❌️</p>
     <p id="ms1E6E18">人口e600京人到達：新しい施設のアンロック ❌️</p>
     <p id="ms1E9E20">人口e9垓人到達：新しいアップグレードのアンロック ❌️</p>
     <p id="ms1E2_88E28">人口e2.88穣人到達：Meta-Pointsのアンロック ❌️</p>
     <p id="ms1E5E30">人口e500穣人到達：ジェネレーター3号機のアンロック ❌️</p>
     <p id="ms1E16Meta">Meta_Points1京到達：ジェネレーター1号機のベース×2 ❌️</p>
     <p id="ms1E52Meta">Meta_Points1恒河沙到達：ジェネレーター4号機のアンロック ❌️</p>
     <p id="ms1E115Meta">Meta_Points1e115到達：プログラム&聖域崩壊の自動購入&ジェネレーター5号機&プログラム^2 ❌️</p>
     <p id="ms1E308Meta">Meta_Points1e308到達：ジェネレーター6〜8号機のアンロック&ジェネレーター1〜5号機の自動購入 ❌️</p>
     <p id="ms1E1E308Meta">人口1e1e308到達：End of Game ❌️</p>
</div>


<div id="Upgrade-tab" style="display: none;">
    <h3>アップグレード</h3>
    <div style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>聖域の真理</h4>
        <p>聖域指数 (shrineExponent) に現在の購入回数を加算します。</p>
        <p>現在の加算値: +<span id="upg1-count">0</span></p>
        <p>コスト: <span id="upg1-cost-display">1e10000000</span>人</p>
        <button onclick="buyUpgrade1()">アップグレードする</button>
    </div>
    <div id="upg2-area" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
    <h4>次元超越</h4>
    <p>多次元宇宙発見により人口は更に増える…聖域指数を更に増大</p>
    <p>現在の購入回数: <span id="upg2-count">0</span></p>
    <p>コスト: <span id="upg2-cost-display">1e3000万</span>人</p>
    <button onclick="buyUpgrade2()">アップグレードする</button>
   </div>
   <div id="upg3-area" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
    <h4>歪曲次元</h4>
    <p>歪曲次元により数多の人間の収容が可能に！聖域指数を更に増大！</p>
    <p>現在の購入回数: <span id="upg3-count">0</span></p>
    <p>コスト: <span id="upg3-cost-display">1e2億</span>人</p>
    <button onclick="buyUpgrade3()">アップグレードする</button>
   </div>
   <div id="upg4-area" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
    <h4>次元生成</h4>
    <p>次元を作成し人間を詰め込む。聖域ベースを累乗</p>
    <p>現在の購入回数: <span id="upg4-count">0</span></p>
    <p>コスト: <span id="upg4-cost-display">1e1兆</span>人</p>
    <button onclick="buyUpgrade4()">アップグレードする</button>
   </div>
    <div id="upg5-area" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
    <h4>聖域崩壊</h4>
    <p>聖域を破壊し超領域を作成する</p>
    <p>現在の購入回数: <span id="upg5-count">0</span></p>
    <p>コスト: <span id="upg5-cost-display">1e1京</span>人</p>
    <button onclick="buyUpgrade5()">アップグレードする</button>
   </div>
</div>
   

<div id="Meta-tab" style="display: none;">
    <h3>Meta-Points</h3>
    <p>Meta-Points: <span id="meta-points">0</span></p>
    <div style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 1</h4>
        <p>所持数: <span id="generator1-amount">0</span></p>
        <p>生産効率: <span id="generator1-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator1-cost">10</span> Meta-Points</p>
        <button onclick="buyGenerator1()">購入する</button>
    </div>
    <div style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 2</h4>
        <p>所持数: <span id="generator2-amount">0</span></p>
        <p>生産効率: <span id="generator2-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator2-cost">100</span> Meta-Points</p>
        <button onclick="buyGenerator2()">購入する</button>
    </div>
    <div id="generator3-display" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 3</h4>
        <p>所持数: <span id="generator3-amount">0</span></p>
        <p>生産効率: <span id="generator3-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator3-cost">1000</span> Meta-Points</p>
        <button onclick="buyGenerator3()">購入する</button>
    </div>
    <div id="generator4-display" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 4</h4>
        <p>所持数: <span id="generator4-amount">0</span></p>
        <p>生産効率: <span id="generator4-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator4-cost">1万</span> Meta-Points</p>
        <button onclick="buyGenerator4()">購入する</button>
    </div>
    <div id="generator5-display" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 5</h4>
        <p>所持数: <span id="generator5-amount">0</span></p>
        <p>生産効率: <span id="generator5-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator5-cost">10万</span> Meta-Points</p>
        <button onclick="buyGenerator5()">購入する</button>
    </div>
    <div id="generator6-display" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 6</h4>
        <p>所持数: <span id="generator6-amount">0</span></p>
        <p>生産効率: <span id="generator6-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator6-cost">100万</span> Meta-Points</p>
        <button onclick="buyGenerator6()">購入する</button>
    </div>
    <div id="generator7-display" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 7 </h4>
        <p>所持数: <span id="generator7-amount">0</span></p>
        <p>生産効率: <span id="generator7-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator7-cost">1000万</span> Meta-Points</p>
        <button onclick="buyGenerator7()">購入する</button>
    </div>
    <div id="generator8-display" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <h4>Generator 8</h4>
        <p>所持数: <span id="generator8-amount">0</span></p>
        <p>生産効率: <span id="generator8-multiplier">1</span> 倍</p>
        <p>コスト: <span id="generator8-cost">1億</span> Meta-Points</p>
        <button onclick="buyGenerator8()">購入する</button>
    </div>
</div>


</div>

<script>
function formatJP(decimal) {
    if (decimal.lt(10000)) return decimal.floor().toString();

    // 単位の定義（無量大数まで）
    const units = ["", "万", "億", "兆", "京", "垓", "秭", "穣", "溝", "澗", "正", "載", "極", "恒河沙", "阿僧祇", "那由他", "不可思議", "無量大数"];
    
    // --- 超巨大数の処理 (指数が 10000 以上の時: 1.00e1万 ～) ---
    if (decimal.exponent >= 10000) {
        let e = decimal.exponent;
        let mantissa = decimal.mantissa.toFixed(2);
        return mantissa + "e" + formatJP(new Decimal(e));
    }

    // --- 巨大数の処理 (無量大数を超えた時: 1.00e72 ～ 9.99e9999) ---
    // 無量大数の上限は 10^72 未満なので、exponent が 72 以上なら指数表記へ
    if (decimal.exponent >= 72) {
        let e = decimal.exponent;
        let mantissa = decimal.mantissa.toFixed(2);
        return mantissa + "e" + e; // ここは「万」をつけない純粋な指数表記にするのが一般的ですが、
                                   // もし「e〇〇万」という独自のルールにしたい場合は e-4 して「万」を付けてください
    }

    // --- 通常の単位処理 (万 ～ 無量大数) ---
    let unitIndex = 0;
    let d = decimal;

    // 10000で割っていき、適切な単位を探す
    while (d.gte(10000) && unitIndex < units.length - 1) {
        d = d.div(10000);
        unitIndex++;
    }

    // メインの数値（例：5兆 の「5」）
    let mainValue = d.floor().toString();
    // 下の単位の数値（例：5兆8600億 の「8600」）
    let subValue = d.minus(d.floor()).times(10000).floor();

    if (subValue.gt(0)) {
        return mainValue + units[unitIndex] + subValue.toString() + units[unitIndex - 1];
    }
    return mainValue + units[unitIndex];
}



// Break_Infinity.jsはe1e9などの表記を直接できないため、それをできるようにしたやつ。形式としてはE(5000)などのようにしたら、10^5000のように処理される
const E_CACHE = {};

function E(exp) {
    if (!E_CACHE[exp]) {
        E_CACHE[exp] = new Decimal(1, exp);
    }
    return E_CACHE[exp];
}

// 10^(a × 10^b)
function EE(a, b) {
    return Decimal.pow(10, a * Math.pow(10, b));
}

</script>





<script>
// --- タブ切り替え（修正版） ---
function showTab(tabName) {
    // すべてのタブを一旦非表示にする
    document.getElementById('main-tab').style.display = 'none';
    document.getElementById('Milestone-tab').style.display = 'none';
    document.getElementById('Upgrade-tab').style.display = 'none'; // これを忘れると消えません！
    document.getElementById('Meta-tab').style.display = 'none';

    // 選んだタブだけを表示する
    document.getElementById(tabName).style.display = 'block';
}


// --- 1. データの管理 ---
let peopleNum = new Decimal(0);
let power = new Decimal(1);
let sacrificeCost = new Decimal(10);

let farmerCount = new Decimal(0);
let farmerCost = new Decimal(500);
let farmerPower = new Decimal(2); 
let grandmaCount = new Decimal(0);
let grandmaCost = new Decimal("1e15");
let grandmaMultiplier = new Decimal(2); // 1人につき農家の効率を2倍にする
let grandmaAutoBuyPower = 20; //グランマの自動購入の買うペース(詳しくは自動購入一回の最大購入数)
let shrineCount = new Decimal(0); // 購入回数
let shrineCost = new Decimal("1e50000"); // 初期コスト
let shrineExponent = new Decimal("2"); //聖域は基本的に聖域の購入回数^2で計算され、その^2の部分
let shrineUnlocked = false; // アンロック状態
let quantumCount = new Decimal(0);
let quantumCost = EE(1,10);
let atomCount = new Decimal(0);
let atomCost = EE(1,12);
let programCount = new Decimal(0);
let programCost = EE(1,18);


// アップグレード変数
let upgrade1Count = new Decimal(0);
let upgrade1Cost = EE(1, 6); // 初期コスト：e1000万 (e1e7) などの非常に高い値に設定
let upgrade2Count = new Decimal(0);
let upgrade2Cost = EE(3, 7); // e3000万
let upgrade3Count = new Decimal(0);
let upgrade3Cost = EE(2, 8); // e2億
let upgrade4Count = new Decimal(0);
let upgrade4Cost = EE(1, 12); // e1兆
let upgrade5Count = new Decimal(0);
let upgrade5Cost = EE(1, 20); // e1京


// Meta-Points関連
let meta_points = new Decimal(1);
let generator1Count = new Decimal(0);
let generator1Cost = new Decimal(1);
let generator1Multi = new Decimal(2);
let generator1Amount = new Decimal(0);
let generator2Count = new Decimal(0);
let generator2Cost = new Decimal(100);
let generator2Multi = new Decimal(2);
let generator2Amount = new Decimal(0);
let generator3Count = new Decimal(0);
let generator3Cost = new Decimal(1000);
let generator3Multi = new Decimal(2);
let generator3Amount = new Decimal(0);
let generator4Count = new Decimal(0);
let generator4Cost = new Decimal(10000);
let generator4Multi = new Decimal(2);
let generator4Amount = new Decimal(0);
let generator5Count = new Decimal(0);
let generator5Cost = new Decimal(100000);
let generator5Multi = new Decimal(2);
let generator5Amount = new Decimal(0);
let generator6Count = new Decimal(0);
let generator6Cost = new Decimal("1e6");
let generator6Multi = new Decimal(2);
let generator6Amount = new Decimal(0);
let generator7Count = new Decimal(0);
let generator7Cost = new Decimal("1e7");
let generator7Multi = new Decimal(2);
let generator7Amount = new Decimal(0);
let generator8Count = new Decimal(0);
let generator8Cost = new Decimal("1e8");
let generator8Multi = new Decimal(2);
let generator8Amount = new Decimal(0);



// マイルストーン達成フラグ（ここで一括管理します）
let autoBuyerUnlocked = false;
let isAutoBuyerActive = true; // 自動購入が有効かどうか
let autoBuyer2Unlocked = false;
let isAutoBuyer2Active = true;
let autoBuyer3Unlocked = false;
let isAutoBuyer3Active = true;
let autoBuyer4Unlocked = false;
let isAutoBuyer4Active = true;

let isMilestone3000Reached = false;
let isMilestone10000Reached = false;
let isMilestone8E9Reached = false; // 「8e9」の代わりに「8E9」とする
let isMilestone8E16Reached = false;
let isMilestone1E400Reached = false;
let isMilestone1E10000Reached = false;
let isMilestone1E50000Reached = false;
let isMilestone1E350000Reached = false;
let isMilestone1E1_2E6Reached = false;
let isMilestone1E2E6Reached = false;
let isMilestone1E3E7Reached = false;
let isMilestone1E5E8Reached = false;
let isMilestone1E1E10Reached = false;
let isMilestone1E2E10Reached = false;
let isMilestone1E7E12Reached = false;
let isMilestone1E5E14Reached = false;
let isMilestone1E5E18Reached = false;
let isMilestone1E6E18Reached = false;
let isMilestone1E9E20Reached = false;
let isMilestone1E2_88E28Reached = false;
let isMilestone1E5E30Reached = false;
let isMilestone1E16Meta = false;
let isMilestone1E52Meta = false;
let isMilestone1E115Meta = false;
let isMilestone1E308Meta = false;
let isMilestone1E1E308Meta = false;

let milestone1E2E10_Effect = new Decimal(1);
let milestone1E16Meta_Effect = new Decimal(1);
let milestone1E115Meta_Effect = new Decimal(1);

// --- 2. 要素の取得 ---
const peopleElement = document.getElementById('people-count');
const powerElement = document.getElementById('power-display');
const sacrificeCostElement = document.getElementById('sacrificeCost-display');
const farmerCostElement = document.getElementById('farmerCost-display');
const perSecondElement = document.getElementById('per-second-display');
const grandmaArea = document.getElementById('grandma-unlock-area');
const grandmaCountElement = document.getElementById('grandma-count');
const grandmaCostElement = document.getElementById('grandmaCost-display');
const boostedMultiplierElement = document.getElementById("boostedMultiplier-display");
const shrineArea = document.getElementById("shrine-area");
const shrineCostElement = document.getElementById("shrineCost-display");
const shrineCountElement = document.getElementById("shrine-count");
const quantumArea = document.getElementById("quantum-area");
const quantumCostElement = document.getElementById("quantumCost-display");
const quantumCountElement = document.getElementById("quantum-count");
const quantumEffectElement = document.getElementById("quantum-effect");
const atomArea = document.getElementById("atom-area");
const atomCostElement = document.getElementById("atomCost-display");
const atomCountElement = document.getElementById("atom-count");
const atomEffectElement = document.getElementById("atom-effect");
const programArea = document.getElementById("program-area");
const programCostElement = document.getElementById("programCost-display");
const programCountElement = document.getElementById("program-count");
const programEffectElement = document.getElementById("program-effect");

const ms3000Element = document.getElementById('ms3000');
const ms10000Element = document.getElementById('ms10000');
const ms8E9Element = document.getElementById('ms8E9');
const ms8E16Element = document.getElementById('ms8E16');
const ms1E400Element = document.getElementById('ms1E400');
const ms1E10000Element = document.getElementById('ms1E10000');
const ms1E50000Element = document.getElementById('ms1E50000');
const ms1E350000Element = document.getElementById('ms1E350000');
const ms1E1_2E6Element = document.getElementById('ms1E1_2E6');
const ms1E2E6Element = document.getElementById('ms1E2E6');
const ms1E3E7Element = document.getElementById('ms1E3E7');
const ms1E5E8Element = document.getElementById('ms1E5E8');
const ms1E1E10Element = document.getElementById('ms1E1E10');
const ms1E2E10Element = document.getElementById('ms1E2E10');
const ms1E7E12Element = document.getElementById('ms1E7E12');
const ms1E5E14Element = document.getElementById('ms1E5E14');
const ms1E5E18Element = document.getElementById('ms1E5E18');
const ms1E6E18Element = document.getElementById('ms1E6E18');
const ms1E9E20Element = document.getElementById('ms1E9E20');
const ms1E2_88E28Element = document.getElementById('ms1E2_88E28');
const ms1E5E30Element = document.getElementById('ms1E5E30');
const ms1E16MetaElement = document.getElementById('ms1E16Meta');
const ms1E52MetaElement = document.getElementById('ms1E52Meta');
const ms1E115MetaElement = document.getElementById('ms1E115Meta');
const ms1E308MetaElement = document.getElementById('ms1E308Meta');
const ms1E1E308MetaElement = document.getElementById('ms1E1E308Meta');




// --- 3. アクション処理 ---
function clickHandler() {
    peopleNum = peopleNum.plus(power);
}

function sacrifice() {
    if (peopleNum.gte(sacrificeCost)) {
        peopleNum = peopleNum.minus(sacrificeCost);
        power = power.plus(2);
        sacrificeCost = sacrificeCost.times(1.5);
    } else {
        alert("生贄にする人口が足りません...");
    }
}

function buyFarmer() {
    if (peopleNum.gte(farmerCost)) {
        // 1. 代金を支払う
        peopleNum = peopleNum.minus(farmerCost);
        farmerCount = farmerCount.plus(1);
        
        // 2. 倍率を決定する (SoftCapのロジック)
        let multiplier = 1.2; // 基本は1.2倍
        if (farmerCount.gte(20)) {
            multiplier = 2.0; // 20人以上なら2倍ずつ増える（SoftCap）
        }

        // 3. 次のコストを計算
        farmerCost = farmerCost.times(multiplier);

        // 4. 農家のパワーを強化
        farmerPower = farmerPower.times(1.5); 
        
    } else {
        // 人口が足りない場合のみここを通る
        alert("人口が足りません！");
    }
}

function buyGrandma() {
    if (peopleNum.gte(grandmaCost)) {
        peopleNum = peopleNum.minus(grandmaCost);
        grandmaCount = grandmaCount.plus(1);
        let multiplier = grandmaCount.gte(1000) ? 20 : 5;
        grandmaCost = grandmaCost.times(multiplier);
    } else {
        alert("グランマを呼ぶにはまだ信仰（人口）が足りません。");
    }
}

function buyShrine() {
    if (!shrineUnlocked) return;

    if (peopleNum.gte(shrineCost)) {
        peopleNum = peopleNum.minus(shrineCost);
        shrineCount = shrineCount.plus(1);

        // コスト ^1.2
        shrineCost = shrineCost.pow(1.2);
    } else {
        alert("人口が足りません！");
    }
}

function buyQuantum() {
    if (peopleNum.gte(quantumCost)) {
        peopleNum = peopleNum.minus(quantumCost);
        quantumCount = quantumCount.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        quantumCost = quantumCost.pow(1.05); 
    } else {
        alert("人口が足りません！");
    }
}

function buyAtom() {
    if (peopleNum.gte(atomCost)) {
        peopleNum = peopleNum.minus(atomCost);
        atomCount = atomCount.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        atomCost = atomCost.pow(1.1); 
    } else {
        alert("人口が足りません！");
    }
}

function buyProgram() {
    if (peopleNum.gte(programCost)) {
        peopleNum = peopleNum.minus(programCost);
        programCount = programCount.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        programCost = programCost.pow(1.1); 
    } else {
        alert("人口が足りません！");
    }
}



// 自動購入用処理

function autoBuyFarmer() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(farmerCost)) break;

        peopleNum = peopleNum.minus(farmerCost);
        farmerCount = farmerCount.plus(1);

        let multiplier = farmerCount.gte(20) ? 2 : 1.2;
        farmerCost = farmerCost.times(multiplier);

        farmerPower = farmerPower.times(1.5);
    }
}

// 1000の上限を外そうと思うが(検査用)、おそらく重くなるためゲーム内アップグレードでは1000を上限にするよう心がけよ
function autoBuyGrandma() {
    for (let i = 0; i < grandmaAutoBuyPower; i++) {
        if (peopleNum.lt(grandmaCost)) break;

        peopleNum = peopleNum.minus(grandmaCost);
        grandmaCount = grandmaCount.plus(1);
        let multiplier = grandmaCount.gte(1000) ? 20 : 5;
        grandmaCost = grandmaCost.times(multiplier);
    }
}

function autoBuyShrine() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(shrineCost)) break;
        
        peopleNum = peopleNum.minus(shrineCost);
        shrineCount = shrineCount.plus(1);

        // コスト ^1.2
        shrineCost = shrineCost.pow(1.2);
    }
}

function autoBuyQuantum() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(quantumCost)) break;
        
        peopleNum = peopleNum.minus(quantumCost);
        quantumCount = quantumCount.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        quantumCost = quantumCost.pow(1.05); 
    }
}

function autoBuyAtom() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(atomCost)) break;
        
        peopleNum = peopleNum.minus(atomCost);
        atomCount = atomCount.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        atomCost = atomCost.pow(1.1); 
    }
}

function autoBuyProgram() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(programCost)) break;
        
        peopleNum = peopleNum.minus(programCost);
        programCount = programCount.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        programCost = programCost.pow(1.1); 
    }
}


function autoBuyUpgrade1() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(upgrade1Cost)) break;
        
        peopleNum = peopleNum.minus(upgrade1Cost);
        upgrade1Count = upgrade1Count.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        upgrade1Cost = upgrade1Cost.pow(1.1); 
    }
}

function autoBuyUpgrade2() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(upgrade2Cost)) break;
        
        peopleNum = peopleNum.minus(upgrade2Cost);    
        upgrade2Count = upgrade2Count.plus(1);
        
        upgrade2Cost = upgrade2Cost.pow(1.1); 
    }
}

function autoBuyUpgrade3() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(upgrade3Cost)) break;
        
        peopleNum = peopleNum.minus(upgrade3Cost);    
        upgrade3Count = upgrade3Count.plus(1);
        
        upgrade3Cost = upgrade3Cost.pow(1.1); 
    }
}

function autoBuyUpgrade4() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(upgrade4Cost)) break;
        
        peopleNum = peopleNum.minus(upgrade4Cost);    
        upgrade4Count = upgrade4Count.plus(1);
        
        upgrade4Cost = upgrade4Cost.pow(1.1); 
    }
}

function autoBuyUpgrade5() {
    for (let i = 0; i < 20; i++) {
        if (peopleNum.lt(upgrade5Cost)) break;
        
        peopleNum = peopleNum.minus(upgrade5Cost);    
        upgrade5Count = upgrade5Count.plus(1);
        
        let multiplier = upgrade5Count.gte(20) ? 4 : 2;
        upgrade5Cost = upgrade5Cost.pow(multiplier); 
    }
}



function autoBuyGenerator1() {
    for (let i = 0; i < 20; i++) {
       if (meta_points.lt(generator1Cost)) break;
       
       meta_points = meta_points.minus(generator1Cost);
       generator1Count = generator1Count.plus(1);
       generator1Amount = generator1Amount.plus(1)
       generator1Cost = generator1Cost.times(10);
      }
}

function autoBuyGenerator2() {
    for (let i = 0; i < 20; i++) {
       if (meta_points.lt(generator2Cost)) break;
       
       meta_points = meta_points.minus(generator2Cost);
       generator2Count = generator2Count.plus(1);
       generator2Amount = generator2Amount.plus(1)
       generator2Cost = generator2Cost.times(100);
      }
}

function autoBuyGenerator3() {
    for (let i = 0; i < 20; i++) {
       if (meta_points.lt(generator3Cost)) break;
       
       meta_points = meta_points.minus(generator3Cost);
       generator3Count = generator3Count.plus(1);
       generator3Amount = generator3Amount.plus(1)
       generator3Cost = generator3Cost.times(1000);
      }
}

function autoBuyGenerator4() {
    for (let i = 0; i < 20; i++) {
       if (meta_points.lt(generator4Cost)) break;
       
       meta_points = meta_points.minus(generator4Cost);
       generator4Count = generator4Count.plus(1);
       generator4Amount = generator4Amount.plus(1)
       generator4Cost = generator4Cost.times(10000);
      }
}

function autoBuyGenerator5() {
    for (let i = 0; i < 20; i++) {
       if (meta_points.lt(generator5Cost)) break;
       
       meta_points = meta_points.minus(generator5Cost);
       generator5Count = generator5Count.plus(1);
       generator5Amount = generator5Amount.plus(1)
       generator5Cost = generator5Cost.times(100000);
      }
}


// --- 関数エリアに追加 ---
function toggleAutoBuyer() {
    isAutoBuyerActive = !isAutoBuyerActive;
    document.getElementById('autobuyer-status').innerText = isAutoBuyerActive ? "ON" : "OFF";
    document.getElementById('autobuyer-status').style.color = isAutoBuyerActive ? "green" : "red";
}

function toggleAutoBuyer2() {
    isAutoBuyer2Active = !isAutoBuyer2Active;
    document.getElementById('autobuyer2-status').innerText = isAutoBuyer2Active ? "ON" : "OFF";
    document.getElementById('autobuyer2-status').style.color = isAutoBuyer2Active ? "green" : "red";
}

function toggleAutoBuyer3() {
    isAutoBuyer3Active = !isAutoBuyer3Active;
    let statusEl = document.getElementById('autobuyer3-status');
    if (statusEl) {
        statusEl.innerText = isAutoBuyer3Active ? "ON" : "OFF";
        statusEl.style.color = isAutoBuyer3Active ? "green" : "red";
    }
}

function toggleAutoBuyer4() {
    isAutoBuyer4Active = !isAutoBuyer4Active;
    let statusEl = document.getElementById('autobuyer4-status');
    if (statusEl) {
        statusEl.innerText = isAutoBuyer4Active ? "ON" : "OFF";
        statusEl.style.color = isAutoBuyer4Active ? "green" : "red";
    }
}



// --- アップグレード関連処理---

// 聖域指数に加算
function buyUpgrade1() {
    if (peopleNum.gte(upgrade1Cost)) {
        peopleNum = peopleNum.minus(upgrade1Cost);
        upgrade1Count = upgrade1Count.plus(1);
        
        // 次のコストを計算 (例: 1.5倍の指数に強化)
        upgrade1Cost = upgrade1Cost.pow(1.1); 
    } else {
        alert("人口が足りません！");
    }
}

function buyUpgrade2() {
    if (peopleNum.gte(upgrade2Cost)) {
        peopleNum = peopleNum.minus(upgrade2Cost);    // ← upgrade2Cost に修正
        upgrade2Count = upgrade2Count.plus(1);
        
        upgrade2Cost = upgrade2Cost.pow(1.1); 
    } else {
        alert("人口が足りません！");
    }
}

function buyUpgrade3() {
    if (peopleNum.gte(upgrade3Cost)) {
        peopleNum = peopleNum.minus(upgrade3Cost);    
        upgrade3Count = upgrade3Count.plus(1);
        
        upgrade3Cost = upgrade3Cost.pow(1.1); 
    } else {
        alert("人口が足りません！");
    }
}

function buyUpgrade4() {
    if (peopleNum.gte(upgrade4Cost)) {
        peopleNum = peopleNum.minus(upgrade4Cost);    
        upgrade4Count = upgrade4Count.plus(1);
        
        upgrade4Cost = upgrade4Cost.pow(1.1); 
    } else {
        alert("人口が足りません！");
    }
}

function buyUpgrade5() {
    if (peopleNum.gte(upgrade5Cost)) {
        peopleNum = peopleNum.minus(upgrade5Cost);    
        upgrade5Count = upgrade5Count.plus(1);
        
        let multiplier = upgrade5Count.gte(20) ? 4 : 2;
        upgrade5Cost = upgrade5Cost.pow(multiplier); 
    } else {
        alert("人口が足りません！");
    }
}


// Meta-PointsのGenerator処理

function buyGenerator1() {
    if (meta_points.gte(generator1Cost)) {
        meta_points = meta_points.minus(generator1Cost);
        // 購入回数と所持数の両方を増やす
        generator1Count = generator1Count.plus(1);
        generator1Amount = generator1Amount.plus(1);
        generator1Cost = generator1Cost.times(10);
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator2() {
    if (meta_points.gte(generator2Cost)) {
        meta_points = meta_points.minus(generator2Cost);
        // 購入回数と所持数の両方を増やす
        generator2Count = generator2Count.plus(1);
        generator2Amount = generator2Amount.plus(1);
        generator2Cost = generator2Cost.times(100);
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator3() {
    if (meta_points.gte(generator3Cost)) {
        meta_points = meta_points.minus(generator3Cost);
        // 購入回数と所持数の両方を増やす
        generator3Count = generator3Count.plus(1);
        generator3Amount = generator3Amount.plus(1);
        generator3Cost = generator3Cost.times(1000);
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator4() {
    if (meta_points.gte(generator4Cost)) {
        meta_points = meta_points.minus(generator4Cost);
        // 購入回数と所持数の両方を増やす
        generator4Count = generator4Count.plus(1);
        generator4Amount = generator4Amount.plus(1);
        generator4Cost = generator4Cost.times(10000);
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator5() {
    if (meta_points.gte(generator5Cost)) {
        meta_points = meta_points.minus(generator5Cost);
        // 購入回数と所持数の両方を増やす
        generator5Count = generator5Count.plus(1);
        generator5Amount = generator5Amount.plus(1);
        generator5Cost = generator5Cost.times(100000);
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator6() {
    if (meta_points.gte(generator6Cost)) {
        meta_points = meta_points.minus(generator6Cost);
        // 購入回数と所持数の両方を増やす
        generator6Count = generator6Count.plus(1);
        generator6Amount = generator6Amount.plus(1);
        generator6Cost = generator6Cost.times("1e80");
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator7() {
    if (meta_points.gte(generator7Cost)) {
        meta_points = meta_points.minus(generator7Cost);
        // 購入回数と所持数の両方を増やす
        generator7Count = generator7Count.plus(1);
        generator7Amount = generator7Amount.plus(1);
        generator7Cost = generator7Cost.times("1e150");
    } else {
        alert("Meta-Pointsが足りません！");
    }
}

function buyGenerator8() {
    if (meta_points.gte(generator8Cost)) {
        meta_points = meta_points.minus(generator8Cost);
        // 購入回数と所持数の両方を増やす
        generator8Count = generator8Count.plus(1);
        generator8Amount = generator8Amount.plus(1);
        generator8Cost = generator8Cost.times("1e300");
    } else {
        alert("Meta-Pointsが足りません！");
    }
}



// --- 4. ロジックと更新 ---

function checkMilestones() {
    // 3000人のマイルストーン
    if (!isMilestone3000Reached && peopleNum.gte(3000)) {
        farmerPower = farmerPower.times(2);
        isMilestone3000Reached = true; 
        console.log("マイルストーン達成：農家の効率が2倍！");
    }
    
    // 10000人のマイルストーン
    if (!isMilestone10000Reached && peopleNum.gte(10000)) {
        power = power.pow(5); // ここは5乗
        isMilestone10000Reached = true; 
        console.log("マイルストーン達成：クリックパワーが5乗！"); // テキストを修正
    }
    
    // 80億人（8e9）のマイルストーン
    if (!isMilestone8E9Reached && peopleNum.gte("8e9")) {
        power = power.pow(2); // ここは2乗
        isMilestone8E9Reached = true;
        alert("現実世界の人口を超える……");
    }
   
   // 8京人（8e16）のマイルストーン
    if (!isMilestone8E16Reached && peopleNum.gte("8e16")) {
        farmerPower = farmerPower.pow(2); 
        isMilestone8E16Reached = true;
        grandmaArea.style.display = "block"; // エリアを表示！
        alert("クッキークリッカーを思い出せ……(グランマの追加[メイン])");
    }
    
    // e400人（1e400）のマイルストーン
if (!isMilestone1E400Reached && peopleNum.gte("1e400")) {
    grandmaMultiplier = grandmaMultiplier.mul(2); 
    isMilestone1E400Reached = true;
    autoBuyerUnlocked = true;
    
    // ★ここを追加：ボタンを表示する
    document.getElementById('autobuyer-controls').style.display = "block";
    
    alert("グランマのベース×2 & 自動購入機能アンロック！");
   }
    
    // e1万人（1e10000）のマイルストーン
    if (!isMilestone1E10000Reached && peopleNum.gte("1e10000")) {
        grandmaMultiplier = grandmaMultiplier.mul(4); 
        isMilestone1E10000Reached = true;
        alert("グランマのベース×4");
    }
    
    // e5万人（1e50000）のマイルストーン
    if (!isMilestone1E50000Reached && peopleNum.gte("1e50000")) {
    isMilestone1E50000Reached = true;
    shrineUnlocked = true;
    shrineArea.style.display = "block";
    alert("他惑星居住をアンロック！これによりグランマベースを増やす施設のアンロック！");
   }
   
   // e35万人（1e350000）のマイルストーン
    if (!isMilestone1E350000Reached && peopleNum.gte("1e350000")) {
    grandmaMultiplier = grandmaMultiplier.pow(2);
    grandmaAutoBuyPower = grandmaAutoBuyPower*5;
    isMilestone1E350000Reached = true;
    alert("おばあちゃんは、こんなんで負けやしないよ…");
   }
   
   // e120万人（1e1.2e6）のマイルストーン | 1_2は変数名で1.2の.が使えないため_で代用したもの
    if (!isMilestone1E1_2E6Reached && peopleNum.gte(EE(1.2, 6))) {
    shrineExponent = shrineExponent.plus(1);
    isMilestone1E1_2E6Reached = true;
    alert("聖域ブースト");
   }
   
   // e200万人（1e2e6）のマイルストーン
    if (!isMilestone1E2E6Reached && peopleNum.gte(EE(2, 6))) {
    shrineExponent = shrineExponent.plus(1);
    isMilestone1E2E6Reached = true;
    
    // ★追加: アップグレードタブのボタンを表示
    document.getElementById('upgrade-tab-btn').style.display = 'inline-block';
    
    alert("聖域ブースト + アップグレードタブのアンロック");
   }
   
   // e3000万人（1e3e7）のマイルストーン
    if (!isMilestone1E3E7Reached && peopleNum.gte(EE(3, 7))) {
    isMilestone1E3E7Reached = true;
    
    document.getElementById('upg2-area').style.display = 'block';
    
    alert("新しいアップグレードのアンロック");
   }
   
   // e5億人（1e5e8）のマイルストーン
    if (!isMilestone1E5E8Reached && peopleNum.gte(EE(5, 8))) {
    isMilestone1E5E8Reached = true;
    
    document.getElementById('upg3-area').style.display = 'block';
    
    alert("新しいアップグレードのアンロック");
    }
    
    // e100億人（1e1e10）のマイルストーン
    if (!isMilestone1E1E10Reached && peopleNum.gte(EE(1, 10))) {
    isMilestone1E1E10Reached = true;
    
    document.getElementById('quantum-area').style.display = 'block';
    
    alert("新しいアップグレードのアンロック");
    }
    
    // e200億人（1e2e10）のマイルストーン
    if (!isMilestone1E2E10Reached && peopleNum.gte(EE(2, 10))) {
    isMilestone1E2E10Reached = true;
    milestone1E2E10_Effect = milestone1E2E10_Effect.plus(1)
    alert("全アップグレード&量子圧縮強化！");
    }
    
    // e7兆人（1e7e12）のマイルストーン
    if (!isMilestone1E7E12Reached && peopleNum.gte(EE(7, 12))) {
    isMilestone1E7E12Reached = true;
    milestone1E2E10_Effect = milestone1E2E10_Effect.times(2)
    alert("ダブル！全アップグレード&量子圧縮強化！");
    }
    
    // e500兆人（1e5e14）のマイルストーン
    if (!isMilestone1E5E14Reached && peopleNum.gte(EE(5, 14))) {
    isMilestone1E5E14Reached = true;
    document.getElementById('atom-area').style.display = 'block';
    document.getElementById('upg4-area').style.display = 'block';
    alert("ダブル！新しい施設と新しいアップグレード");
    }
    
    // e500京人（1e5e18）のマイルストーン
    if (!isMilestone1E5E18Reached && peopleNum.gte(EE(5, 18))) {
    isMilestone1E5E18Reached = true;
    autoBuyer2Unlocked = true;
    document.getElementById('autobuyer2-controls').style.display = 'block';
    alert("アップグレード1〜4&施設:聖域、量子圧縮、原子回帰の自動購入");
    }
    
    // e600京人（1e6e18）のマイルストーン
    if (!isMilestone1E6E18Reached && peopleNum.gte(EE(6, 18))) {
    isMilestone1E6E18Reached = true;
    document.getElementById('program-area').style.display = 'block';
    alert("新しい施設のアンロック");
    }
    
    // e9垓人（1e9e20）のマイルストーン
    if (!isMilestone1E9E20Reached && peopleNum.gte(EE(9, 20))) {
    isMilestone1E9E20Reached = true;
    document.getElementById('upg5-area').style.display = 'block';
    alert("新しいアップグレードのアンロック");
    }
    
    if (!isMilestone1E2_88E28Reached && peopleNum.gte(EE(2.88, 28))) {
    isMilestone1E2_88E28Reached = true;
    document.getElementById('meta-tab-btn').style.display = 'inline-block';
    document.getElementById('meta-exponent').style.display = 'block';
    alert("Meta-Pointsのアンロック");
    }
    
    if (!isMilestone1E5E30Reached && peopleNum.gte(EE(5, 30))) {
    isMilestone1E5E30Reached = true;
    document.getElementById('generator3-display').style.display = 'block';
    alert("ジェネレーター3号機のアンロック");
    }
    
    if (!isMilestone1E16Meta && meta_points.gte("1e16")) {
    isMilestone1E16Meta = true;
    milestone1E16Meta_Effect = milestone1E16Meta_Effect.times(2);
    alert("ジェネレーター1号機のベース強化");
    }
    
    if (!isMilestone1E52Meta && meta_points.gte("1e52")) {
    isMilestone1E52Meta = true;
    document.getElementById('generator4-display').style.display = 'block';
    alert("ジェネレーター4号機のアンロック");
    }
    
    if (!isMilestone1E115Meta && meta_points.gte("1e115")) {
    isMilestone1E115Meta = true;
    autoBuyer3Unlocked = true;
    document.getElementById('autobuyer3-controls').style.display = 'block';
    document.getElementById('generator5-display').style.display = 'block';
    milestone1E115Meta_Effect = milestone1E115Meta_Effect.times(2);
    alert("プログラム&聖域崩壊の自動購入&ジェネレーター5号機&プログラム^2 アンロック！");
   }
   
   if (!isMilestone1E308Meta && meta_points.gte("1e308")) {
    isMilestone1E308Meta = true;
    autoBuyer4Unlocked = true;
    document.getElementById('autobuyer4-controls').style.display = 'block';
    document.getElementById('generator6-display').style.display = 'block';
    document.getElementById('generator7-display').style.display = 'block';
    document.getElementById('generator8-display').style.display = 'block';
    alert("ジェネレーター6〜8号機のアンロック&ジェネレーター1〜5号機の自動購入");
    }
    
    if (!isMilestone1E1E308Meta && peopleNum.gte(EE(1,307))) {
    isMilestone1E1E308Meta
    alert("Infinity^2!!!Break_Infinity.jsの上限値となったため強制的にこのゲームは終了します。");
    }

}



function updateMilestoneUI() {
    ms3000Element.innerText = "人口3000人到達：農家効率2倍 " + (isMilestone3000Reached ? "✅" : "❌");
    ms10000Element.innerText = "人口10000人到達：クリック^5 " + (isMilestone10000Reached ? "✅" : "❌"); // ^5 に修正
    ms8E9Element.innerText = "人口80億人到達：クリック^2 " + (isMilestone8E9Reached ? "✅" : "❌");
    ms8E16Element.innerText = "人口8京人到達：農家効率^2 " + (isMilestone8E16Reached ? "✅" : "❌");
    ms1E400Element.innerText = "人口e400人到達：グランマベース×2 " + (isMilestone1E400Reached ? "✅" : "❌");
    ms1E10000Element.innerText = "人口e1万人到達：グランマベース×4 " + (isMilestone1E10000Reached ? "✅" : "❌");
    ms1E50000Element.innerText = "人口e5万人到達：新しい施設のアンロック " + (isMilestone1E50000Reached ? "✅" : "❌");
    ms1E350000Element.innerText = "人口e35万人到達：グランマベース^2&グランマ自動購入効率×5 " + (isMilestone1E350000Reached ? "✅" : "❌");
    ms1E1_2E6Element.innerText = "人口e120万人到達：聖域指数に+1" + (isMilestone1E1_2E6Reached ? "✅" : "❌");
    ms1E2E6Element.innerText = "人口e200万人到達：聖域指数に+1&アップグレードタブアンロック" + (isMilestone1E2E6Reached ? "✅" : "❌");
    ms1E3E7Element.innerText = "人口e3000万人到達：新しいアップグレードのアンロック" + (isMilestone1E3E7Reached ? "✅" : "❌");
    ms1E5E8Element.innerText = "人口e5億人到達：新しいアップグレードのアンロック" + (isMilestone1E5E8Reached ? "✅" : "❌");
    ms1E1E10Element.innerText = "人口e100億人到達：新しい施設のアンロック" + (isMilestone1E1E10Reached ? "✅" : "❌");
    ms1E2E10Element.innerText = "人口e200億人到達：全アップグレード&全施設強化！" + (isMilestone1E2E10Reached ? "✅" : "❌");
    ms1E7E12Element.innerText = "人口e7兆人到達：ダブル全アップグレード&全施設強化！" + (isMilestone1E7E12Reached ? "✅" : "❌");
    ms1E5E14Element.innerText = "人口e500兆人到達：ダブル新しい施設と新しいアップグレード" + (isMilestone1E5E14Reached ? "✅" : "❌");
    ms1E5E18Element.innerText = "人口e500京人到達：アップグレード1〜4&施設:聖域、量子圧縮、原子回帰の自動購入" + (isMilestone1E5E18Reached ? "✅" : "❌");
    ms1E6E18Element.innerText = "人口e600京人到達：新しい施設のアンロック" + (isMilestone1E6E18Reached ? "✅" : "❌");
    ms1E9E20Element.innerText = "人口e9該人到達：新しいアップグレードのアンロック" + (isMilestone1E9E20Reached ? "✅" : "❌");
    ms1E2_88E28Element.innerText = "人口e2.88穣人到達：Meta-Pointsのアンロック" + (isMilestone1E2_88E28Reached ? "✅" : "❌");
    ms1E5E30Element.innerText = "人口e500穣人到達：ジェネレーター3号機をアンロック" + (isMilestone1E5E30Reached ? "✅" : "❌");
    ms1E16MetaElement.innerText = "Meta_Points1京到達：ジェネレーター1号機のベース×2" + (isMilestone1E16Meta ? "✅" : "❌");
    ms1E52MetaElement.innerText = "Meta_Points1恒河沙到達：ジェネレーター4号機のアンロック" + (isMilestone1E52Meta ? "✅" : "❌");
    ms1E115MetaElement.innerText = "Meta_Points1e115到達：プログラム&聖域崩壊の自動購入&ジェネレーター5号機&プログラム^2" + (isMilestone1E115Meta ? "✅" : "❌");
    ms1E308MetaElement.innerText = "Meta_Points1e308到達：ジェネレーター6〜8号機のアンロック&ジェネレーター1〜5号機の自動購入" + (isMilestone1E308Meta ? "✅" : "❌");
    ms1E1E308MetaElement.innerText = "人口ee308到達：End of Game" + (isMilestone1E1E308Meta ? "✅" : "❌");
}


// --- メインループ内（修正版ロジック） ---
setInterval(function() {
// Meta-Pointsの生産ロジック (AD方式: Generator1がポイントを生産)
// 1個購入あたりの乗数
let gen1Multiplier = (generator1Multi.times(milestone1E16Meta_Effect)).pow(generator1Count);
let gen2Multiplier = generator2Multi.pow(generator2Count);
let gen3Multiplier = generator3Multi.pow(generator3Count);
let gen4Multiplier = generator4Multi.pow(generator4Count);
let gen5Multiplier = generator5Multi.pow(generator5Count);
let gen6Multiplier = generator6Multi.pow(generator6Count);
let gen7Multiplier = generator7Multi.pow(generator7Count);
let gen8Multiplier = generator8Multi.pow(generator8Count);


// そのジェネレーターの生産量(Amount*乗数)
let generator7Gain = generator8Amount.times(gen8Multiplier).div(10); 
let generator6Gain = generator7Amount.times(gen7Multiplier).div(10); 
let generator5Gain = generator6Amount.times(gen6Multiplier).div(10); 
let generator4Gain = generator5Amount.times(gen5Multiplier).div(10); 
let generator3Gain = generator4Amount.times(gen4Multiplier).div(10); 
let generator2Gain = generator3Amount.times(gen3Multiplier).div(10); 
let generator1Gain = generator2Amount.times(gen2Multiplier).div(10); 
let metaPointsGain = generator1Amount.times(gen1Multiplier).div(10); // 0.1秒ごとの生産

// 最終的な生産処理
generator7Amount = generator7Amount.plus(generator7Gain);
generator6Amount = generator6Amount.plus(generator6Gain);
generator5Amount = generator5Amount.plus(generator5Gain);
generator4Amount = generator4Amount.plus(generator4Gain);
generator3Amount = generator3Amount.plus(generator3Gain);
generator2Amount = generator2Amount.plus(generator2Gain);
generator1Amount = generator1Amount.plus(generator1Gain);
meta_points = meta_points.plus(metaPointsGain);


let metaPower = (meta_points.pow(0.1)).plus(1);
    // 1. 各種倍率の計算
    let programEffect = (programCount.div(2).plus(1)).pow(milestone1E115Meta_Effect);
    let atomEffect = (atomCount.div(10).plus(1)).times(programEffect);
    let effectiveExponent = ((shrineExponent.plus(upgrade1Count.times(milestone1E2E10_Effect)))
                            .times((upgrade2Count.div(10).plus(1)).times(milestone1E2E10_Effect))
                            .times((upgrade3Count.div(10).plus(1)).times(milestone1E2E10_Effect))
                            ).pow(upgrade5Count.div(30).plus(1));
    let upgrade4Effect = (upgrade4Count.div(2)).plus(1);
    let shrineBoost = (shrineCount.max(1).pow(upgrade4Effect)).pow(effectiveExponent); 
    let boostedgrandmaMultiplier = grandmaMultiplier.times(shrineBoost);
    
    // 量子圧縮の効果（例：1つにつき +0.02 の指数加算）
    let quantumEffect = (((quantumCount.div(50)).plus(1)).times(milestone1E2E10_Effect)).times(atomEffect);

    // 2. 基礎生産量（農家）
    let totalFarmerPower = farmerCount.times(farmerPower);

    // 3. グランマ倍率の適用
    if (grandmaCount.gt(0)) {
        totalFarmerPower = totalFarmerPower.times(boostedgrandmaMultiplier.pow(grandmaCount));
    }
    
    // 4. 量子圧縮の適用（全体の最終値に対して累乗）
    if (quantumCount.gt(0)) {
        totalFarmerPower = totalFarmerPower.pow(quantumEffect);
    }
    
    //Meta-Pointsの10乗根分累乗する
    if (isMilestone1E2_88E28Reached) {
        totalFarmerPower = totalFarmerPower.pow(metaPower);
    }

    // 5. 増加量と加算
    let gainPerTick = totalFarmerPower.div(10);
    peopleNum = peopleNum.plus(gainPerTick);
    
    // ...以下、UI更新など
    if (autoBuyerUnlocked && isAutoBuyerActive) {
        autoBuyFarmer();
        autoBuyGrandma();
    }
    
    if (autoBuyer2Unlocked && isAutoBuyer2Active) {
        autoBuyShrine();
        autoBuyQuantum();
        autoBuyAtom();
        autoBuyUpgrade1();
        autoBuyUpgrade2();
        autoBuyUpgrade3();
        autoBuyUpgrade4();
    }
    
    if (autoBuyer3Unlocked && isAutoBuyer3Active) {
        autoBuyProgram();
        autoBuyUpgrade5();
    }
    
    if (autoBuyer4Unlocked && isAutoBuyer4Active) {
        autoBuyGenerator1();
        autoBuyGenerator2();
        autoBuyGenerator3();
        autoBuyGenerator4();
        autoBuyGenerator5();
    }
    
    checkMilestones();

    // 画面表示の更新
    peopleElement.innerText = formatJP(peopleNum); 
    powerElement.innerText = formatJP(power);
    sacrificeCostElement.innerText = formatJP(sacrificeCost);
    farmerCostElement.innerText = formatJP(farmerCost);
    grandmaCountElement.innerText = grandmaCount.toString();
    grandmaCostElement.innerText = formatJP(grandmaCost);
    boostedMultiplierElement.innerText = formatJP(boostedgrandmaMultiplier);
    shrineCountElement.innerText = shrineCount.toString();
    shrineCostElement.innerText = formatJP(shrineCost);
    quantumCountElement.innerText = quantumCount.toString();
    quantumCostElement.innerText = formatJP(quantumCost);
    quantumEffectElement.innerText = quantumEffect.toFixed(2);
    atomCountElement.innerText = atomCount.toString();
    atomCostElement.innerText = formatJP(atomCost);
    atomEffectElement.innerText = formatJP(atomEffect);
    programCountElement.innerText = programCount.toString();
    programCostElement.innerText = formatJP(programCost);
    programEffectElement.innerText = formatJP(programEffect);
    perSecondElement.innerText = formatJP(totalFarmerPower); // 正しい合計値を表示
    
    // アップグレード解放時のみ更新
    if (isMilestone1E2E6Reached) {
        document.getElementById('upg1-count').innerText = upgrade1Count.toString();
        document.getElementById('upg1-cost-display').innerText = formatJP(upgrade1Cost);
    }
    
    // アップグレード2解放時のみ更新
    if (isMilestone1E3E7Reached) {
        document.getElementById('upg2-count').innerText = upgrade2Count.toString();
        document.getElementById('upg2-cost-display').innerText = formatJP(upgrade2Cost);
   }
   
   // アップグレード3解放時のみ更新
    if (isMilestone1E5E8Reached) {
        document.getElementById('upg3-count').innerText = upgrade3Count.toString();
        document.getElementById('upg3-cost-display').innerText = formatJP(upgrade3Cost);
   }
   
   // アップグレード4解放時のみ更新
   if (isMilestone1E5E14Reached) {
        document.getElementById('upg4-count').innerText = upgrade4Count.toString();
        document.getElementById('upg4-cost-display').innerText = formatJP(upgrade4Cost);
   }
   
   // アップグレード4解放時のみ更新
   if (isMilestone1E9E20Reached) {
        document.getElementById('upg5-count').innerText = upgrade5Count.toString();
        document.getElementById('upg5-cost-display').innerText = formatJP(upgrade5Cost);
   }
   
   
   document.getElementById('meta-points').innerText = formatJP(meta_points);
   document.getElementById('meta-power').innerText = formatJP(metaPower);
document.getElementById('generator1-amount').innerText = formatJP(generator1Amount);
document.getElementById('generator1-cost').innerText = formatJP(generator1Cost);
document.getElementById('generator1-multiplier').innerText = formatJP(gen1Multiplier);
document.getElementById('generator2-amount').innerText = formatJP(generator2Amount);
document.getElementById('generator2-cost').innerText = formatJP(generator2Cost);
document.getElementById('generator2-multiplier').innerText = formatJP(gen2Multiplier);
document.getElementById('generator3-amount').innerText = formatJP(generator3Amount);
document.getElementById('generator3-cost').innerText = formatJP(generator3Cost);
document.getElementById('generator3-multiplier').innerText = formatJP(gen3Multiplier);
document.getElementById('generator4-amount').innerText = formatJP(generator4Amount);
document.getElementById('generator4-cost').innerText = formatJP(generator4Cost);
document.getElementById('generator4-multiplier').innerText = formatJP(gen4Multiplier);
document.getElementById('generator5-amount').innerText = formatJP(generator5Amount);
document.getElementById('generator5-cost').innerText = formatJP(generator5Cost);
document.getElementById('generator5-multiplier').innerText = formatJP(gen5Multiplier);
document.getElementById('generator6-amount').innerText = formatJP(generator6Amount);
document.getElementById('generator6-cost').innerText = formatJP(generator6Cost);
document.getElementById('generator6-multiplier').innerText = formatJP(gen6Multiplier);
document.getElementById('generator7-amount').innerText = formatJP(generator7Amount);
document.getElementById('generator7-cost').innerText = formatJP(generator7Cost);
document.getElementById('generator7-multiplier').innerText = formatJP(gen7Multiplier);
document.getElementById('generator8-amount').innerText = formatJP(generator8Amount);
document.getElementById('generator8-cost').innerText = formatJP(generator8Cost);
document.getElementById('generator8-multiplier').innerText = formatJP(gen8Multiplier);
    
    updateMilestoneUI();
}, 100);


</script>

</body>
</html>
